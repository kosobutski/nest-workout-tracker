# Backend-система для трекера силовых спортивных тренировок на NestJS 

## Описание

Backend-приложение, позволяющее пользователям записывать в базу данных информацию о том, какие физические упражнения (из заранее созданного в БД списка) они выполняли.

## Кратко о структуре БД

Полная структура моделей баз данных приведена в файле src/prisma/schema.prisma.\
Кратко: существуют модели User (пользователь, имеет имя, email, пол и т. д.) и Exercise (упражнение, имеет название, описание, перечисление задействованных в упражнении мышц и т. д.).
Обе эти модели имеют автоинкрементное поле id, предназначенное для связки пользователя с выполненным упражнением в модели WorkoutLog - эта модель также содержит поля количества подходов, повторений за 1 подход
и вес (опционально). Таким образом, база данных приведена в 3НФ и транзитивные зависимости отсутствуют.

## Эндпоинты

### /users
```GET /users``` - получить массив всех пользователей\
```GET /users/:id``` - получить конкретного пользователя по id\
```POST /users``` - создать нового пользователя\
```PATCH /users/:id``` - обновить информацию о пользователе\
```DELETE /users/:id``` - удалить пользователя по id

### /exercises
```GET /exercises``` - получить массив всех упражнений\
```GET /exercises/:id``` - получить информацию о конкретном упражнении по id\
```POST /exercises``` - создать новое упражнениея\
```PATCH /exercises/:id``` - обновить информацию об упражнении\
```DELETE /exercises/:id``` - удалить упражнение по id

### /workout-log
```GET /workout-log``` - получить массив всех записей о выполненных упражнениях (для авторизованного пользователя)\
```GET /workout-log/:id``` - получить конкретную запись по id\
```POST /workout-log``` - создать новоую запись\
```PATCH /workout-log/:id``` - обновить запись\
```DELETE /workout-log/:id``` - удалить запись по id

### /auth
```POST /auth/login``` - авторизация

Для взаимодействия с эндпоинтом /workout-log пользователь должен быть авторизован. С использованием Bearer-токена он сможет взаимодействовать только с записями, связанными с его аккаунтом
(то есть только с теми записями WorkoutLog, где в поле userId указан его id). В противном случае пользователь получит ошибку ```401 Unauthorized```.

## Авторизация
Авторизация сделана на основе стандарта JWT. Для входа в систему и получения возможности полноценного пользования приложением, пользователь должен иметь запись о себе в таблице User (а следовательно - иметь зарегистрированный email и пароль). Если такая запись есть, то пользователю следует отправить POST-запрос на эндпоинт /auth/login, где в body запроса указать свои значения email и password. При успешной авторизации пользователю будет выдан access token (действителен в течение 30 дней), который при последующих запросах на /workout-log нужно передавать в заголовке Authorization по шаблону ```Bearer ${access_token}```.

## Настройка

```bash
$ yarn install
$ npx prisma migrate
```
Перед запуском нужно создать файл ```.env``` и указать в нем свои значения переменных окружения. Нужные названия переменных представлены в файле ```.env.example```.

## Запуск

```bash
# development
$ yarn start

# watch mode
$ yarn start:dev

# production mode
$ yarn start:prod
```
